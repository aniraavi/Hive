#sample data in the input file
"1","CERTIFIED-WITHDRAWN","UNIVERSITY OF MICHIGAN","BIOCHEMISTS AND BIOPHYSICISTS","POSTDOCTORAL RESEARCH FELLOW","N",36067,2016,"ANN ARBOR, MICHIGAN",-83.7430378,42.2808256
"2","CERTIFIED-WITHDRAWN","GOODMAN NETWORKS, INC.","CHIEF EXECUTIVES","CHIEF OPERATING OFFICER","Y",242674,2016,"PLANO, TEXAS",-96.6988856,33.0198431
"3","CERTIFIED-WITHDRAWN","PORTS AMERICA GROUP, INC.","CHIEF EXECUTIVES","CHIEF PROCESS OFFICER","Y",193066,2016,"JERSEY CITY, NEW JERSEY",-74.0776417,40.7281575

#create the table in hive
create table practice.h1b_applicantions(s_no int,case_status string,employer_name string,soc_name string,job_title string, full_time_position string,
prevailing_wage int,year string,worksite string,longitude double,latitude double)
row format serde 'org.apache.hadoop.hive.serde2.OpenCSVSerde'
with serdeproperties("separatorChar" = ",","quoteChar" = "\"")
stored as textfile;

#load the data from the local file system to hive table
load data local inpath 'h1b_applicants_data/h1b.csv' overwrite into table practice.h1b_applicantions;

#check if the data is properly loaded or not
select * from practice.h1b_applicantions limit 3;
1       CERTIFIED-WITHDRAWN     UNIVERSITY OF MICHIGAN  BIOCHEMISTS AND BIOPHYSICISTS   POSTDOCTORAL RESEARCH FELLOW    N       36067   2016    ANN ARBOR, MICHIGAN    -83.7430378      42.2808256
2       CERTIFIED-WITHDRAWN     GOODMAN NETWORKS, INC.  CHIEF EXECUTIVES        CHIEF OPERATING OFFICER Y       242674  2016    PLANO, TEXAS    -96.6988856     33.0198431
3       CERTIFIED-WITHDRAWN     PORTS AMERICA GROUP, INC.       CHIEF EXECUTIVES        CHIEF PROCESS OFFICER   Y       193066  2016    JERSEY CITY, NEW JERSEY -74.0776417     40.7281575


#number of petitions for data engineer post every year? to check if they are increasing or decreasing?
select year,count(year) from practice.h1b_applicantions where job_title like '%DATA ENGINEER%' group by year order by year DESC;
OK
2016    786
2015    394
2014    249
2013    151
2012    81
2011    60

#to get the number of positions for each kind of data engineer position?
select year,job_title,count(year) from practice.h1b_applications where job_title like '%DATA ENGINEER%' group by year,job_title order by year,job_title DESC;
2016    TERADATA ENGINEER       1
2016    TECHNICAL LEAD, DATA ENGINEERING        1
2016    STAFF DATA ENGINEER     7
2016    SR. MANAGER, DATA ENGINEERING   1
2016    SR. HADOOP BIG DATA ENGINEER    1
2016    SR. ENGINEER, DATA ENGINEERING & APPS (ENGINEER 3)      1
2016    SR. DATA ENGINEER, MTS2 1

#collect the list of all the data engineer petitions for every year
select year,count(year),collect_set(job_title) from practice.h1b_applications where job_title like '%DATA ENGINEER%' group by year order by year DESC;
2016    786     ["DATA ENGINEERING MANAGER III","MANAGER, DATA ENGINEERING","HEAD OF DATA ENGINEERING & SCIENCE","DIRECTOR, BIG DATA ENGINEERING","DATA ENGINEERING MANAGER","SEARCH LEAD, DATA ENGINEERING","BIG DATA ENGINEERING MANAGER","DIRECTOR OF DATA ENGINEERING","PRINCIPAL DATA ENGINEERING MANAGER","MASTER DATA ENGINEER","INTEGRATED SUPPLY CHAIN DATA ENGINEER","DATA ENGINEER","QUANTITATIVE STATISTICAL DATA ENGINEER","SENIOR DATA ENGINEER","BIG DATA ENGINEER","DATA ENGINEER II","TERADATA ENGINEER","LEAD DATA ENGINEER (ENGINEER 5)","SOLUTION CENTER DATA ENGINEER I","SAP BIG DATA ENGINEER P3","ASSOCIATE DATA ENGINEER","PRINCIPAL DATA ENGINEER","SR. DATA ENGINEER III (TECH YAHOO, SOFTWARE APPS DEV ENG)","SR. DATA ENGINEER","ADVISORY DATA ENGINEER","BIG DATA ENGINEERING EXPERT","LEAD DATA ENGINEER","SR. MANAGER, DATA ENGINEERING","DATA ENGINEER/ PYTHON DEVELOPER","BIG DATA ENGINEER/ HADOOP DEVELOPER","PROGRAMMER ANALYST - SR. BIG DATA ENGINEER","STAFF DATA ENGINEER","SENIOR BIG DATA ENGINEER","SENIOR GLOBAL DATA ENGINEER","PRINCIPAL SOFTWARE DATA ENGINEER","SR. HADOOP BIG DATA ENGINEER","DATA ENGINEER - PLATFORM COMMUNICATIONS","DATA ENGINEER - COMMUNICATIONS PLATFORM","SOFTWARE DATA ENGINEER","DATA ENGINEER III","DATA ENGINEER I","DATA SCIENCE ANALYST/BIG DATA ENGINEER","SOFTWARE/DATA ENGINEER","LEAD DATA ENGINEER 1 DATA &AMP; ANALYTICS","SENIOR DATA ENGINEER - APPLICATION AND DEVELOPMENT","SECURITY AND BIG DATA ENGINEER","SR. DATA ENGINEER - DATA WAREHOUSING","SR SOFTWARE AND DATA ENGINEER","SENIOR PYTHON/BIG DATA ENGINEER","DATA ENGINEER, GLOBAL SOURCING","SENIOR DATA ENGINEER, CONSUMER DIGITAL TECHNOLOGY","ORACLE APPLICATION DATABASE ADMINISTRATOR/DATA ENGINEER","SR. BIG DATA ENGINEER","DATA ENGINEER/ANALYST","JAVA BIG DATA ENGINEER","DATA ENGINEER - HADOOP DEVELOPER","ASSOCIATE BIG DATA ENGINEER","JR. DATA ENGINEER","GENOMIC DATA ENGINEER","SENIOR SEARCH DATA ENGINEER","BIG DATA ENGINEER/DATA SCIENCE ANALYST","SR DATA ENGINEER","SENIOR SOFTWARE ENGINEER, DATA ENGINEERING","DATA ENGINEER II, ETL","NOSQL DATA ENGINEER","DATA ENGINEER 11","DATA WAREHOUSE DATA ENGINEER","ODI DATA ENGINEER","BIG DATA ENGINEER/SOFTWARE ENGINEER","SENIOR SEARCH BACK-END DATA ENGINEER","IT ANALYST, DATA ENGINEERING","DATA ENGINEER LEAD","SENIOR ANALYTICS ASSOCIATE - DATA ENGINEERING","DATA ENGINEER V (SOFTWARE APPLICATIONS)","BIG DATA ENGINEER/SOFTWARE DEVELOPER","SENIOR MANAGER, DATA ENGINEERING","SR. DATA ENGINEER & SOLUTIONS","DATA ENGINEERING LEAD (SENIOR MANAGER)","DATA ENGINEERING TECHNICAL LEAD","JUNIOR DATA ENGINEER","SENIOR STAFF DATA ENGINEER","SQL AND BIG DATA ENGINEER","LEAD DATA ENGINEER - BI","DATA ENGINEER, PRODUCT DATA SCIENCE","EA MOBILE DATA ENGINEER","DEVOPS DATA ENGINEER","FIELD DATA ENGINEER","SENIOR DATA ENGINEER I","SR. DATA ENGINEER, BIG DATA PLATFORM","SR. DATA ENGINEER, MTS2","DATA ENGINEER - DELIVERY","ETL/DATA ENGINEER","SENIOR MARKET DATA ENGINEER","DATA ENGINEER, DATA PLATFORMS","NETWORK DATA ENGINEER","HADOOP/BIG DATA ENGINEER","DATA ENGINEER (SOLUTIONS)","DATA ENGINEERING MANAGER (15-1199.09)","SR. CONSULTANT, DATA ENGINEERING","DATA ENGINEER, JR. ENGINEER (15-1199.02)","HADOOP DATA ENGINEER","GLOBAL PRODUCT DATA ENGINEER","BIGDATA ENGINEERÂ ","BIG DATA ENGINEER - BACKEND/HIVE","DATA ENGINEER (15-1199.02)","PRINCIPAL BIG DATA ENGINEER","PRINCIPAL BIG DATA ENGINEER/DATA SCIENTIST","TECHNICAL LEAD, DATA ENGINEERING","SENIOR TECHNICAL PROJECT MANAGER - DATA ENGINEERING","CRM DATA ENGINEER, LEAD","SR. ENGINEER, DATA ENGINEERING & APPS (ENGINEER 3)","BI DATA ENGINEER","SENIOR KNOWLEDGE ANALYST - DATA ENGINEERING","ASSISTANT VICE PRESIDENT, DATA ENGINEERING","CLINICAL DATA ENGINEER","DATA ENGINEERING ANALYST II","PRINCIPAL DATA ENGINEER/ANALYST, BIG DATA"]

#which part of the US has most data engineer jobs?
select split(worksite,',')[1] as state,count(split(worksite,',')[1]) as state_wise_job_count from practice.h1b_applications where job_title like '%DATA ENGINEER%' group by split(worksite,',')[1] order by state_wise_job_count DESC;
 CALIFORNIA     745
 WASHINGTON     350
 NEW YORK       167
 MASSACHUSETTS  69
 ILLINOIS       58
 TEXAS  51
 GEORGIA        38
 NEW JERSEY     25
 MICHIGAN       20

#number of petitions every year by state for data engineer position
select split(worksite,',')[1] as state,year,count(split(worksite,',')[1]) as state_wise_job_count from practice.h1b_applications where job_title like '%DATA ENGINEER%' group by split(worksite,',')[1],year order by year,state_wise_job_count,state DESC;
 INDIANA        2011    1
 FLORIDA        2011    1
 CONNECTICUT    2011    1
 COLORADO       2011    1
 GEORGIA        2011    2
 MICHIGAN       2011    3
 TEXAS  2011    4
 MASSACHUSETTS  2011    4
 NEW YORK       2011    5

#the number different kinds of data engineer position that are present in each state
select split(worksite,',')[1] as state,job_title,count(split(worksite,',')[1]) as state_wise_job_count from practice.h1b_applications where job_title like '%DATA ENGINEER%' group by split(worksite,',')[1],job_title order by state_wise_job_count DESC;
 CALIFORNIA     DATA ENGINEER   323
 WASHINGTON     DATA ENGINEER II        175
 CALIFORNIA     SENIOR DATA ENGINEER    96
 NEW YORK       DATA ENGINEER   88
 WASHINGTON     DATA ENGINEER I 78
 CALIFORNIA     BIG DATA ENGINEER       50
 WASHINGTON     DATA ENGINEER III       27
 MASSACHUSETTS  DATA ENGINEER   24

#which industry has most number of data scientists positions(top 5)
select soc_name,count(soc_name) from practice.h1b_applications where job_title like '%DATA SCIENTIST%' group by soc_name order by DESC limit 5;
STATISTICIANS   649
COMPUTER AND INFORMATION RESEARCH SCIENTISTS    500
OPERATIONS RESEARCH ANALYSTS    426
Computer and Information Research Scientists    208
COMPUTER OCCUPATIONS, ALL OTHER 179
Time taken: 311.013 seconds, Fetched: 5 row(s)

#which employer files most petitions per yesr
select employer_name,year,count(employer_name) as total_petitions from practice.h1b_applications group by employer_name,year order by total_petitions DESC limit 5;
INFOSYS LIMITED 2015    33245
INFOSYS LIMITED 2013    32223
INFOSYS LIMITED 2016    25352
INFOSYS LIMITED 2014    23759
CAPGEMINI AMERICA INC   2016    16725
Time taken: 504.67 seconds, Fetched: 5 row(s)


